##############
### TODO
### check opp squid reload OK
### check opp other sudo command OK
### logrotate -d /opt/logrotate/etc/squid OK 
### /opt/logrotate/status/logrotate.status OK
### /var/spool/cron/logreader OK
### upgrade python to 3.9.20 OK
### upgrade pip to 3.9.20 OK
### upgrade pip module to 3.9.20
### verify squid show redis version
### chown -R logreader.logreader /opt/squid_shell OK
### chmod g+w /opt/squid/var/log
### chmod g+w /opt/squid/var/log/cache.log
### chmod g+w /opt/nginx/html/transproxy_admin
### chmod g+w /opt/nginx/html/transproxy_admin/storage/logs
### chown nginx.www-group /opt/nginx/html/transproxy_admin/storage/temp
### chmod g+w /opt/nginx/html/transproxy_admin/storage/temp
### chmod g+w /opt/nginx/html/transproxy_admin/public/fileData/threat
### chmod g+w /opt/nginx/html/transproxy_admin/public/fileData/threat/*.txt
### chmod g+w /opt/nginx/html/threat/archive
### chmod 644 /etc/logrotate.d/squid
### create account logreader
### run logrote as logreader
### run crontab as logreader
### fix logrote issue
### run ansible-playbook as logreader
### Ansible Vault
### sudo 
### nginx ALL=(root) NOPASSWD: /usr/bin/python3 *
# 只允许运行 /opt/py_prod/ 目录下的任何 python 脚本
###nginx ALL=(root) NOPASSWD: /usr/bin/python3 /opt/py_prod/*
###   python  log /opt/squid_shell/logs/
###   /opt/py_prod/log   
###   /usr/nginx/html/threat/archive/
### 30 3 * * * /usr/bin/find /var/crash -maxdepth 1 -name 'squid.*.core.*' -mtime +1 -print -delete
###
##############

--
logreader ALL=(ALL) NOPASSWD:  
/bin/systemctl stop redis, 
/bin/systemctl start redis, 
/bin/systemctl reload squid, 
/usr/bin/cp -f /opt/redis_bak/dump.rdb_release* /opt/redis/dump.rdb, 
/usr/bin/rm -f /opt/redis/dump.rdb, 
/usr/bin/chown -R redis.redis /opt/redis/dump.rdb,
/usr/bin/journalctl -u redis,
/usr/bin/journalctl -u squid,
/usr/bin/journalctl -u redis -n 100 --no-pager,
/usr/bin/journalctl -u squid -n 100 --no-pager,
/usr/bin/rsync -a /usr/nginx/html/transproxy_admin/public/fileData/ /opt/fileData_bak/*/,
#/usr/bin/rsync -a --no-delay-updates --inplace --ignore-times /opt/txt_release/*/ /usr/nginx/html/transproxy_admin/public/fileData/
/usr/bin/chown -R squid.squid /usr/nginx/html/transproxy_admin/public/fileData
